
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>A complex grading script Â· SketchResponse</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.1.0">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="physics_grader.html" />
    
    
    <link rel="prev" href="simple_grader.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="getting_started.html">
            
                <a href="getting_started.html">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="using_sr.html">
            
                <a href="using_sr.html">
            
                    
                    Using SketchResponse
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="template.html">
            
                <a href="template.html">
            
                    
                    A grading script template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="simple_grader.html">
            
                <a href="simple_grader.html">
            
                    
                    A simple grading script
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.3" data-path="complex_grader.html">
            
                <a href="complex_grader.html">
            
                    
                    A complex grading script
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="physics_grader.html">
            
                <a href="physics_grader.html">
            
                    
                    A physics grading script
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="local_test.html">
            
                <a href="local_test.html">
            
                    
                    Testing your script
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="deployment.html">
            
                <a href="deployment.html">
            
                    
                    Deployment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="edx_quickstart.html">
            
                <a href="edx_quickstart.html">
            
                    
                    edX
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="probconfig_plugins.html">
            
                <a href="probconfig_plugins.html">
            
                    
                    Sketch Tool Configuration Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="api/">
            
                <a href="api/">
            
                    
                    Grader Library API Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="offline_docs.html">
            
                <a href="offline_docs.html">
            
                    
                    Offline Documentation
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >A complex grading script</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="a-more-realistic-grader-script">A more realistic grader script</h1>
<p>This document will walk through the implementation of a grader script for
a more complicated problem than the <a href="simple_grader.html">Simple Grader Tutorial</a> tutorial. The
problem description for this grader script is below.</p>
<p>Sketch the function <i>f(x)</i> = <i>2x</i><sup>2</sup> / <i>x</i><sup>2</sup> - 1.</p> 
<p>Label vertical and horizontal asymptotes, extrema, and inflection points.</p>

<p>This problem will introduce new javascript drawing plugins to handle labeling
asymptotes and points and some new backend API functions that can be used to
evaluate these new sources of data.</p>
<h2 id="imports">Imports</h2>
<p>There are three SketchResponse python modules that must be imported for this simple example. As you saw in the <a href="simple_grader.html">Simple Grader Tutorial</a> all grader scripts must import the <code>sketchresponse</code> module. We again need to input the <code>GradeableFunction</code> module from <code>grader_lib</code>, but also need to import the <code>Asymptote</code> module
to support the asymptote labeling task.</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> sketchresponse
<span class="hljs-keyword">from</span> grader_lib <span class="hljs-keyword">import</span> GradeableFunction, Asymptote
</code></pre>
<h2 id="problem-configuration">Problem configuration</h2>
<p>The problem configuration is passed to the javascript front end to define the
size and scale of the drawing space and to define which drawing tools are
available for the problem. The <code>sketchresponse.config()</code> function takes a dict of
configuration options.</p>
<p>In the example configuration below, the first seven key/value pairs are required. In this configuration we increase the ranges of the X and Y axes compared to the <a href="simple_grader.html">Simple Grader Tutorial</a>:</p>
<ul>
<li><code>&apos;width&apos;: 750</code> sets the pixel width of the drawing space as 750 pixels</li>
<li><code>&apos;height&apos;: 420</code> sets the pixel height of the drawing space to 420 pixels</li>
<li><code>&apos;xrange&apos;: [-3.5, 3.5]</code> sets the numerical range of the x axis</li>
<li><code>&apos;yrange&apos;: [-4.5, 4.5]</code> sets the numerical range of the y axis</li>
<li><code>&apos;xscale&apos;: &apos;linear&apos;</code> sets the scale of the x axis to linear (only option currently implemented)</li>
<li><code>&apos;yscale&apos;: &apos;linear&apos;</code> sets the scale of the y axis to linear (only option currently implemented)</li>
<li><code>&apos;coordinates&apos;: &apos;cartesian&apos; or &apos;polar&apos;</code> sets the coordinate system used by the axes plugin to either cartesian or polar</li>
</ul>
<p>The last entry <code>&apos;plugins&apos;</code> takes a list of dicts that enable the specific javascript plugins that are available to the user. All plugins are declared by &apos;name&apos;.</p>
<p>The &apos;axes&apos; and &apos;freeform&apos; plugin usage here is identical to the <a href="simple_grader.html">Simple Grader Tutorial</a> and is explained there as well as on the <a href="probconfig_plugins.html">Plugin Description Page</a>.</p>
<p>There are three new plugins introduced in this grading script: &apos;vertical-line&apos;, &apos;horizontal-line&apos;, and &apos;point&apos;. The declaration of these plugins is very similar to the declaration of the &apos;freeform&apos; plugin, however, each type of plugin has one additional parameter that needs to be defined: &apos;dashStyle&apos; for the lines, and &apos;size&apos; for the points.</p>
<p>The &apos;vertical-line&apos; plugin entry enables the a labeling tool for vertical asymptotes. It has four configuration options to set:</p>
<ul>
<li><code>&apos;id&apos;</code> sets the name of the argument of the grader callback function (described in the <a href="#grader">next section</a>) to which the data generated by this plugin is passed.</li>
<li><code>&apos;label&apos;</code> is the name of the tool displayed to the user.</li>
<li><code>&apos;color&apos;</code> is the color used to render the drawn function.</li>
<li><code>&apos;dashStyle&apos;</code> is the style of dashed line to used to draw the asymptote.</li>
</ul>
<p>The &apos;horizontal-line&apos; plugin entry enables a labeling tool for horizontal asymptotes. Its configuration options mirror the &apos;vertical-line&apos;.</p>
<p>In this problem, we want students to label both extrema points and the inflection point for the function. To do this we can declare two instances of the &apos;point&apos; plugin with different &apos;id&apos; and &apos;label&apos; values. The &apos;point&apos; plugin has four configuration options to set:</p>
<ul>
<li><code>&apos;id&apos;</code> sets the name of the argument of the grader callback function (described in the <a href="#grader">next section</a>) to which the data generated by this plugin is passed.</li>
<li><code>&apos;label&apos;</code> is the name of the tool displayed to the user.</li>
<li><code>&apos;color&apos;</code> is the color used to render the drawn function.</li>
<li><code>&apos;size&apos;</code> is the pixel width of the point drawn by the plugin.</li>
</ul>
<p>A listing of all the built-in plugins can be found at <a href="probconfig_plugins.html">SketchResponse Plugins</a>.</p>
<pre><code class="lang-python">problemconfig = sketchresponse.config({
    <span class="hljs-string">&apos;width&apos;</span>: <span class="hljs-number">750</span>,
    <span class="hljs-string">&apos;height&apos;</span>: <span class="hljs-number">420</span>,
    <span class="hljs-string">&apos;xrange&apos;</span>: [<span class="hljs-number">-3.5</span>, <span class="hljs-number">3.5</span>],
    <span class="hljs-string">&apos;yrange&apos;</span>: [<span class="hljs-number">-4.5</span>, <span class="hljs-number">4.5</span>],
    <span class="hljs-string">&apos;xscale&apos;</span>: <span class="hljs-string">&apos;linear&apos;</span>,
    <span class="hljs-string">&apos;yscale&apos;</span>: <span class="hljs-string">&apos;linear&apos;</span>,
    <span class="hljs-string">&apos;plugins&apos;</span>: [
        {<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;axes&apos;</span>},
        {<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;freeform&apos;</span>, <span class="hljs-string">&apos;id&apos;</span>: <span class="hljs-string">&apos;f&apos;</span>, <span class="hljs-string">&apos;label&apos;</span>: <span class="hljs-string">&apos;Function f(x)&apos;</span>, <span class="hljs-string">&apos;color&apos;</span>:<span class="hljs-string">&apos;blue&apos;</span>},
        {<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;vertical-line&apos;</span>, <span class="hljs-string">&apos;id&apos;</span>: <span class="hljs-string">&apos;va&apos;</span>, <span class="hljs-string">&apos;label&apos;</span>: <span class="hljs-string">&apos;Vertical asymptote&apos;</span>, <span class="hljs-string">&apos;color&apos;</span>: <span class="hljs-string">&apos;gray&apos;</span>, <span class="hljs-string">&apos;dashStyle&apos;</span>: <span class="hljs-string">&apos;dashdotted&apos;</span>},
        {<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;horizontal-line&apos;</span>, <span class="hljs-string">&apos;id&apos;</span>: <span class="hljs-string">&apos;ha&apos;</span>, <span class="hljs-string">&apos;label&apos;</span>: <span class="hljs-string">&apos;Horizontal asymptote&apos;</span>, <span class="hljs-string">&apos;color&apos;</span>: <span class="hljs-string">&apos;gray&apos;</span>, <span class="hljs-string">&apos;dashStyle&apos;</span>: <span class="hljs-string">&apos;dashdotted&apos;</span>},
        {<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;point&apos;</span>, <span class="hljs-string">&apos;id&apos;</span>: <span class="hljs-string">&apos;cp&apos;</span>, <span class="hljs-string">&apos;label&apos;</span>: <span class="hljs-string">&apos;Extremum&apos;</span>, <span class="hljs-string">&apos;color&apos;</span>: <span class="hljs-string">&apos;black&apos;</span>, <span class="hljs-string">&apos;size&apos;</span>: <span class="hljs-number">15</span>},
        {<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;point&apos;</span>, <span class="hljs-string">&apos;id&apos;</span>: <span class="hljs-string">&apos;ip&apos;</span>, <span class="hljs-string">&apos;label&apos;</span>: <span class="hljs-string">&apos;Inflection point&apos;</span>, <span class="hljs-string">&apos;color&apos;</span>:<span class="hljs-string">&apos;orange&apos;</span>,<span class="hljs-string">&apos;size&apos;</span>: <span class="hljs-number">15</span>}
    ]
})
</code></pre>
<p>The above problem configuration settings will create a javascript tool that looks something like the image below.</p>
<p><img src="imgs/complex_grader.png" alt="What the user will see" title="Complex Config"></p>
<h2 id="define-the-grader-callback-function">Define the grader callback function</h2>
<div id="grader"></div>

<h3 id="handling-the-input-data">Handling the input data</h3>
<pre><code class="lang-python"><span class="hljs-meta">@sketchresponse.grader</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">grader</span><span class="hljs-params">(f,cp,ip,va,ha)</span>:</span>

    f = GradeableFunction.GradeableFunction(f)
    cp = GradeableFunction.GradeableFunction(cp)
    va = Asymptote.VerticalAsymptotes(va)
    ha = Asymptote.HorizontalAsymptotes(ha)
    ip = GradeableFunction.GradeableFunction(ip)

    msg=<span class="hljs-string">&apos;&apos;</span>
</code></pre>
<p>The first thing that the grader function needs to do is format the input data so that <a href="https://SketchResponse.github.io/sketchresponse" _target="blank">Grader Library API</a> methods of interest can be used to check specific features of the input data.</p>
<p>As explained in the <a href="simple_grader.html">Simple Grader Tutorial</a> the data is passed to the grader function as a dictionary with keys equal to the &apos;id&apos; values used in the pluginconfig above so the dictionary can be directly unpacked into argument variables with the same names.</p>
<p>The &apos;freeform&apos; and &apos;point&apos; data are evaluated with API methods in the <code>GradeableFunction.GradeableFunction</code> class. The &apos;vertical-line&apos; and &apos;horizontal-line&apos; data are evaluted with API methods in the <code>Asymptote.VerticalAsymptote</code> and &apos;Asymptote.HorizontalAsymptote` classes respectively.</p>
<p>The <code>msg</code> variable will be used when evaluating specific checks on the data to supply check specific feedback to the student if errors are found.</p>
<h3 id="checking-the-number-of-extrema-points-labeled">Checking the number of extrema points labeled</h3>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> cp.get_number_of_points() != <span class="hljs-number">1</span>:
   <span class="hljs-keyword">if</span> cp.get_number_of_points() == <span class="hljs-number">3</span>:
      msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt;Are you sure about the number of extrema? (note that you should not label the endpoints of your function)&lt;/font&gt;&lt;br /&gt;&apos;</span>
   <span class="hljs-keyword">else</span>:
    msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt;Are you sure about the number of extrema?&lt;/font&gt;&lt;br /&gt;&apos;</span>
</code></pre>
<p>This first check verifies that there is only one extremum point labeled in the input data. It also checks for a common error case where students label the end points of their function to provide more helpful feedback.</p>
<h3 id="checking-the-number-of-inflection-points">Checking the number of inflection points</h3>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> ip.get_number_of_points() != <span class="hljs-number">0</span>:
   msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt;Are you sure about the number of extrema?&lt;/font&gt;&lt;br /&gt;&apos;</span>
</code></pre>
<p>This particular function does not have any inflection points so this check verifies that the student did not put any unnecessary labels.</p>
<h3 id="checking-the-number-of-asymptotes">Checking the number of asymptotes</h3>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> va.get_number_of_asyms() != <span class="hljs-number">2</span>:
   msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Are you sure about the number of vertical asymptotes?&lt;/font&gt;&lt;br /&gt;&apos;</span>


<span class="hljs-keyword">if</span> ha.get_number_of_asyms() != <span class="hljs-number">1</span>:
   msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Are you sure about the number of horizontal asymptotes?&lt;/font&gt;&lt;br /&gt;&apos;</span>
</code></pre>
<p>This function should have 2 vertical asymptote labels and 1 horizontal asymptote label. If either of theses checks fail, appropriate feedback messages are provided.</p>
<h3 id="checking-the-position-of-the-extremum-point">Checking the position of the extremum point</h3>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cp.has_point_at(x=<span class="hljs-number">0</span>):
   msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Check the x value of your critical point&lt;/font&gt;&lt;br /&gt;&apos;</span>
</code></pre>
<p>The extremum point label for the function should be at position <code>x=0</code>.</p>
<h3 id="checking-the-positions-of-the-asymptotes">Checking the positions of the asymptotes</h3>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> va.has_asym_at_value(<span class="hljs-number">-1</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> va.has_asym_at_value(<span class="hljs-number">1</span>):
   v1 = va.closest_asym_to_value(<span class="hljs-number">-1</span>)
   v2 = va.closest_asym_to_value(<span class="hljs-number">1</span>)
   msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Check the locations of your vertical asymptotes.  &lt;/font&gt;&lt;br /&gt;&apos;</span>

<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ha.has_asym_at_value(<span class="hljs-number">2</span>):
   ha1 = ha.closest_asym_to_value(<span class="hljs-number">2</span>)
   msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Check the locations of your horizontal asymptotes. &lt;/font&gt;&lt;br /&gt;&apos;</span>
</code></pre>
<p>The vertical asymptotes should be at positions <code>x=-1</code> and <code>x=1</code>. The horizonal asymptote should be at the position <code>y=2</code>. As you can see, you can also get references to the actual asymptote values if you wanted to use them for further checks, or to customize your feedback messages.</p>
<h3 id="checking-that-the-extremum-point-is-on-the-freeform-line">Checking that the extremum point is on the freeform line</h3>
<pre><code class="lang-python">maxpt = cp.get_point_at(x=<span class="hljs-number">0</span>)

<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> f.has_value_y_at_x(maxpt.y, maxpt.x):
   msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Make sure your critical points lie on your function!&lt;/font&gt;&lt;br /&gt;&apos;</span>
</code></pre>
<p>Here we get a reference to the extremum point and use that point&apos;s x and y coordinates to make sure that it is sitting on the freeform line of the function. The grader method does use a configurable threshold value to ensure pixel perfect placement is not necessary to pass this kind of check.</p>
<h3 id="checking-the-increasing-and-decreasing-ranges-of-the-freeform-line">Checking the increasing and decreasing ranges of the freeform line</h3>
<pre><code class="lang-python">increasing_ok = f.is_increasing_between(<span class="hljs-number">-4</span>, <span class="hljs-number">-1</span>) <span class="hljs-keyword">and</span> f.is_increasing_between(<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>)
decreasing_ok = f.is_decreasing_between(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>) <span class="hljs-keyword">and</span> f.is_decreasing_between(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (increasing_ok <span class="hljs-keyword">and</span> decreasing_ok):
   msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Where should the graph be increasing and decreasing?&lt;/font&gt;&lt;br /&gt;&apos;</span>
</code></pre>
<p>The freeform line drawn by the student should be increasing over the ranges <code>(-4,-1)</code> and <code>(-1,0)</code>. It should also be decreasing over the ranges <code>(0,1)</code> and <code>(1,4)</code>. Again these grading methods have configurable thresholds to ensure they don&apos;t unfairly fail student input.</p>
<h3 id="checking-the-value-of-the-freeform-line-over-specific-ranges">Checking the value of the freeform line over specific ranges</h3>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> f.is_greater_than_y_between(<span class="hljs-number">2</span>,<span class="hljs-number">-4</span>,<span class="hljs-number">-1</span>):
   msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Your function seems to be in the wrong region on the interval (-4,-1)&lt;/font&gt;&lt;br /&gt;&apos;</span>

<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> f.is_greater_than_y_between(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>):
   msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Your function seems to be in the wrong region on the interval (1,4)&lt;/font&gt;&lt;br /&gt;&apos;</span>

<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> f.is_less_than_y_between(<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>):
   msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Your function seems to be in the wrong region on the interval (-1,1)&lt;/font&gt;&lt;br /&gt;&apos;</span>
</code></pre>
<p>Here we are performing three sanity checks on the values of the freeform line over specific ranges. First, we check that <code>f(x) &gt;= 2</code> over the range <code>(-4,-1)</code>. Second, we check that <code>f(x) &gt;= 2</code> over the range <code>(1,4)</code>. Lastly, we check that <code>f(x) &lt;= 0</code> over the range <code>(-1,1)</code>.</p>
<h3 id="checking-the-curvature-of-the-freeform-line">Checking the curvature of the freeform line</h3>
<pre><code class="lang-python">curvature_up_ok = f.has_positive_curvature_between(<span class="hljs-number">-4</span>, <span class="hljs-number">-1</span>) <span class="hljs-keyword">and</span> f.has_positive_curvature_between(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)
curvature_down_ok= f.has_negative_curvature_between(<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>)

<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (curvature_up_ok <span class="hljs-keyword">and</span> curvature_down_ok):
   msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Where is the function convave up and concave down?&lt;/font&gt;&lt;br /&gt;&apos;</span>
</code></pre>
<p>The final checks we will perform make sure that the freeform line has the expected curvature over specific ranges. The curvature should be positive over the ranges <code>(-4,-1)</code> and <code>(1,4)</code>. The curvature should be negative over the range <code>(-1,1)</code>.</p>
<h3 id="putting-it-all-together">Putting it all together</h3>
<p>Combining all the code above into a single function gives us the following. You will notice that the error message variable <code>msg</code> is tested at multiple points during the evaluation and used as an early failure condition. If the numbers of expected labels are not correct, then future checks are likely to not be able to run on the data so returning early ensures the student gets good feedback.</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> sketchresponse
<span class="hljs-keyword">from</span> grader_lib <span class="hljs-keyword">import</span> GradeableFunction, Asymptote

problemconfig = sketchresponse.config({
    <span class="hljs-string">&apos;width&apos;</span>: <span class="hljs-number">750</span>,
    <span class="hljs-string">&apos;height&apos;</span>: <span class="hljs-number">420</span>,
    <span class="hljs-string">&apos;xrange&apos;</span>: [<span class="hljs-number">-3.5</span>, <span class="hljs-number">3.5</span>],
    <span class="hljs-string">&apos;yrange&apos;</span>: [<span class="hljs-number">-4.5</span>, <span class="hljs-number">4.5</span>],
    <span class="hljs-string">&apos;xscale&apos;</span>: <span class="hljs-string">&apos;linear&apos;</span>,
    <span class="hljs-string">&apos;yscale&apos;</span>: <span class="hljs-string">&apos;linear&apos;</span>,
    <span class="hljs-string">&apos;plugins&apos;</span>: [
        {<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;axes&apos;</span>},
        {<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;freeform&apos;</span>, <span class="hljs-string">&apos;id&apos;</span>: <span class="hljs-string">&apos;f&apos;</span>, <span class="hljs-string">&apos;label&apos;</span>: <span class="hljs-string">&apos;Function f(x)&apos;</span>, <span class="hljs-string">&apos;color&apos;</span>:<span class="hljs-string">&apos;blue&apos;</span>},
        {<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;vertical-line&apos;</span>, <span class="hljs-string">&apos;id&apos;</span>: <span class="hljs-string">&apos;va&apos;</span>, <span class="hljs-string">&apos;label&apos;</span>: <span class="hljs-string">&apos;Vertical asymptote&apos;</span>, <span class="hljs-string">&apos;color&apos;</span>: <span class="hljs-string">&apos;gray&apos;</span>, <span class="hljs-string">&apos;dashStyle&apos;</span>: <span class="hljs-string">&apos;dashdotted&apos;</span>},
        {<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;horizontal-line&apos;</span>, <span class="hljs-string">&apos;id&apos;</span>: <span class="hljs-string">&apos;ha&apos;</span>, <span class="hljs-string">&apos;label&apos;</span>: <span class="hljs-string">&apos;Horizontal asymptote&apos;</span>, <span class="hljs-string">&apos;color&apos;</span>: <span class="hljs-string">&apos;gray&apos;</span>, <span class="hljs-string">&apos;dashStyle&apos;</span>: <span class="hljs-string">&apos;dashdotted&apos;</span>},
        {<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;point&apos;</span>, <span class="hljs-string">&apos;id&apos;</span>: <span class="hljs-string">&apos;cp&apos;</span>, <span class="hljs-string">&apos;label&apos;</span>: <span class="hljs-string">&apos;Extremum&apos;</span>, <span class="hljs-string">&apos;color&apos;</span>: <span class="hljs-string">&apos;black&apos;</span>, <span class="hljs-string">&apos;size&apos;</span>: <span class="hljs-number">15</span>},
        {<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;point&apos;</span>, <span class="hljs-string">&apos;id&apos;</span>: <span class="hljs-string">&apos;ip&apos;</span>, <span class="hljs-string">&apos;label&apos;</span>: <span class="hljs-string">&apos;Inflection point&apos;</span>, <span class="hljs-string">&apos;color&apos;</span>:<span class="hljs-string">&apos;orange&apos;</span>,<span class="hljs-string">&apos;size&apos;</span>: <span class="hljs-number">15</span>}
    ]
})

<span class="hljs-meta">@sketchresponse.grader</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">grader</span><span class="hljs-params">(f,cp,ip,va,ha)</span>:</span>

    f = GradeableFunction.GradeableFunction(f)
    cp = GradeableFunction.GradeableFunction(cp)
    va = Asymptote.VerticalAsymptotes(va)
    ha = Asymptote.HorizontalAsymptotes(ha)
    ip = GradeableFunction.GradeableFunction(ip)

    msg=<span class="hljs-string">&apos;&apos;</span>

    <span class="hljs-keyword">if</span> cp.get_number_of_points() != <span class="hljs-number">1</span>:
        <span class="hljs-keyword">if</span> cp.get_number_of_points() == <span class="hljs-number">3</span>:
            msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt;Are you sure about the number of extrema? (note that you should not label the endpoints of your function)&lt;/font&gt;&lt;br /&gt;&apos;</span>
        <span class="hljs-keyword">else</span>:
            msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt;Are you sure about the number of extrema?&lt;/font&gt;&lt;br /&gt;&apos;</span>


    <span class="hljs-keyword">if</span> ip.get_number_of_points() != <span class="hljs-number">0</span>:
        msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt;Are you sure about the number of extrema?&lt;/font&gt;&lt;br /&gt;&apos;</span>

    <span class="hljs-keyword">if</span> va.get_number_of_asyms() != <span class="hljs-number">2</span>:
        msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Are you sure about the number of vertical asymptotes?&lt;/font&gt;&lt;br /&gt;&apos;</span>


    <span class="hljs-keyword">if</span> ha.get_number_of_asyms() != <span class="hljs-number">1</span>:
        msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Are you sure about the number of horizontal asymptotes?&lt;/font&gt;&lt;br /&gt;&apos;</span>

    <span class="hljs-keyword">if</span> msg != <span class="hljs-string">&apos;&apos;</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">False</span>, msg
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cp.has_point_at(x=<span class="hljs-number">0</span>):
            msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Check the x value of your critical point&lt;/font&gt;&lt;br /&gt;&apos;</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> va.has_asym_at_value(<span class="hljs-number">-1</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> va.has_asym_at_value(<span class="hljs-number">1</span>):
            v1 = va.closest_asym_to_value(<span class="hljs-number">-1</span>)
            v2 = va.closest_asym_to_value(<span class="hljs-number">1</span>)
            msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Check the locations of your vertical asymptotes.  &lt;/font&gt;&lt;br /&gt;&apos;</span>

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ha.has_asym_at_value(<span class="hljs-number">2</span>):
            ha1 = ha.closest_asym_to_value(<span class="hljs-number">2</span>)
            msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Check the locations of your horizontal asymptotes. &lt;/font&gt;&lt;br /&gt;&apos;</span>

        maxpt = cp.get_point_at(x=<span class="hljs-number">0</span>)

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> f.has_value_y_at_x(maxpt.y, maxpt.x):
            msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Make sure your critical points lie on your function!&lt;/font&gt;&lt;br /&gt;&apos;</span>

        increasing_ok = f.is_increasing_between(<span class="hljs-number">-4</span>, <span class="hljs-number">-1</span>) <span class="hljs-keyword">and</span> f.is_increasing_between(<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>)
        decreasing_ok = f.is_decreasing_between(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>) <span class="hljs-keyword">and</span> f.is_decreasing_between(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)
        curvature_up_ok = f.has_positive_curvature_between(<span class="hljs-number">-4</span>, <span class="hljs-number">-1</span>) <span class="hljs-keyword">and</span> f.has_positive_curvature_between(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)
        curvature_down_ok= f.has_negative_curvature_between(<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>)


        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (increasing_ok <span class="hljs-keyword">and</span> decreasing_ok):
            msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Where should the graph be increasing and decreasing?&lt;/font&gt;&lt;br /&gt;&apos;</span>

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> f.is_greater_than_y_between(<span class="hljs-number">2</span>,<span class="hljs-number">-4</span>,<span class="hljs-number">-1</span>):
            msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Your function seems to be in the wrong region on the interval (-4,-1)&lt;/font&gt;&lt;br /&gt;&apos;</span>

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> f.is_greater_than_y_between(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>):
            msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Your function seems to be in the wrong region on the interval (1,4)&lt;/font&gt;&lt;br /&gt;&apos;</span>

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> f.is_less_than_y_between(<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>):
            msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Your function seems to be in the wrong region on the interval (-1,1)&lt;/font&gt;&lt;br /&gt;&apos;</span>


        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (curvature_up_ok <span class="hljs-keyword">and</span> curvature_down_ok):
            msg += <span class="hljs-string">&apos;&lt;font color=&quot;blue&quot;&gt; Where is the function convave up and concave down?&lt;/font&gt;&lt;br /&gt;&apos;</span>

    <span class="hljs-keyword">if</span> msg == <span class="hljs-string">&apos;&apos;</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">True</span>,<span class="hljs-string">&apos;Good Job&apos;</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">False</span>, msg
</code></pre>
<h2 id="testing-the-script">Testing the script</h2>
<p>Once the script is written, you can run the script in the local testing server. See the <a href="local_test.html">Test a Grading Script on a Local Server</a> tutorial for details on installing and running the testing server.</p>
<p>There is already a copy of this grader script in the <code>grader_scripts</code> directory so all you need to do is start the server and point your browser of choice to the url:</p>
<pre><code>http://localhost:5000/complex_grader
</code></pre><p>You should see the configured Sketch Tool. If you sketch the function shown at the beginning of this tutorial, you should see an accept message. Any other sketches should return a reject message.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="simple_grader.html" class="navigation navigation-prev " aria-label="Previous page: A simple grading script">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="physics_grader.html" class="navigation navigation-next " aria-label="Next page: A physics grading script">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"A complex grading script","level":"1.3.3","depth":2,"next":{"title":"A physics grading script","level":"1.3.4","depth":2,"path":"physics_grader.md","ref":"physics_grader.md","articles":[]},"previous":{"title":"A simple grading script","level":"1.3.2","depth":2,"path":"simple_grader.md","ref":"simple_grader.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"root":"docs/","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"SketchResponse","gitbook":"*"},"file":{"path":"complex_grader.md","mtime":"2017-06-09T19:30:30.000Z","type":"markdown"},"gitbook":{"version":"3.1.0","time":"2017-06-09T19:39:59.993Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

